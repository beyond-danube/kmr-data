# Відкритті дані щодо [поіменних голосувань](https://kmr.gov.ua/uk/result_golosuvanya) Київради
## Про проєкт
В цьому репозиторії зібрані дані надані на сайті Київради. Файли виправлені таким чином, що одразу піддаються роботі та машинному аналіз. 
  
Також є [Swagger](https://beyond-danube.github.io/kmr-data/). Ніякого бекенду за ним немає, він просто віддає JSON, проте має формат зрозумілий всім хто працював з REST.

## Детальніше
### Навіщо робити будь-які модифікації у файлах, они ж вже відкриті?
Ніколи не буває чистого датасету. В даному випадку основних проблем неточності такі:
  
  
#### Пунктуація
В різних файлах буває різна пунктуація чи кількість проділів, приклад   
`Муха  В.В.`  
`Муха В.В.`  
`Муха В. В. `      
які зустрічаються у документах потребували б додаткової логіки в машинному аналізі, інакше це були б 3 різні особи. Ми їх одразу привели до спільного вже у самих даних.

#### Невалідний JSON
Зустрічаються документи, де назви компаній в лапках без escape characters, вбо перенос рядка без відповідних carriage return символів. На спробі десереалізації таких документів однозначно буде виключення. На подив, сам факт того що такі документи є наводить на думку, що можливо у системі яка збирає ці дані не користувались білбіотеками для серіалізації, а написали свою реалізацію запису файлів, схожих на JSON. Це дуже дивно, проте таких документів більше 100, тобто є певний тренд. Такі файли виправлені вручну.

Як бачимо навіть синтаксис тут, на Ґітхабі, помічає невалідність, так само як і будь-яка IDE. Саме ця помилка досить дивна, ми точно не знаємо яка з систем відповідає за відкриті дані, у Київраді для голосувань використовується Рада-4, можливо вона і пише дані у JSON не знаючи про серіалізацію, я просто як текст. 
  
Оригінальний / Виправлений документ `220120_15.json`
```json
"GL_Text": "За включення до порядку денного питання про врегулювання земельних та майнових відносин використання земельної ділянки,
 що розташована за адресою місто Київ вулиця Симона Петлюри будинок 29  (08/231-1317/ПР)",
```
```json
"GL_Text": "За включення до порядку денного питання про врегулювання земельних та майнових відносин використання земельної ділянки, що розташована за адресою місто Київ вулиця Симона Петлюри будинок 29  (08/231-1317/ПР)",
```
Оригінальний / Виправлений документ `220223_22.json`
```json
"GL_Text": "За внесення до порядку денного питання про внесення змін до рішення Київської міської ради від 04.11.2021 № 3135/3176 "Про Регламент Київської міської ради" (Від 13.05.2022 № 08/231-642)",
```
```json
"GL_Text": "За внесення до порядку денного питання про внесення змін до рішення Київської міської ради від 04.11.2021 № 3135/3176 \"Про Регламент Київської міської ради\" (Від 13.05.2022 № 08/231-642)",
```

#### Дані у XLSX
Деякі дані на початку 2021 року представлені не у JSON, а у XLSX. Вони приведені до формату JSON.

## Використання
Алгоритм досить простий, ми кладемо нові дані опубліковані Київрадою, виправляємо теми описані вище, автоматично або вручну, і додаємо у цей репозиторій.
  
Практично кроки такі:
* Кладено нові файли у папку `data-raw-json`
* Виконуємо ті правки, які можливо зробити автоматично `npm run process-raw-data && create-data-lite && create-date-map`
* В консолі бачимо які файли автоматично обробити не вдалось, бо це невалідний JSON, їх виправляємо вручну
* Виконуємо генерацію ще раз `npm run process-raw-data && npm run create-data-lite && npm run create-date-map`
* (Опціонально) Виконуємо тести `npm test`
* Зберігаємо файли у Ґітхабі `git add .` `git commit -m "added data"` `git push`

## Тести
![](https://github.com/beyond-danube/kmr-data/actions/workflows/node.yml/badge.svg)
  
Ми перевіряємо, чи якийсь файл не загубився в ході виправлення та групування. Тести автоматично виконуються при пул ріквесті або пуші у main гілку.
